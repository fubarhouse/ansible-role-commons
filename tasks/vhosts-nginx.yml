---

- name: "Virtual hosts | NGINX | Create virtual host (conf.d)"
  become: yes
  become_user: root
  template:
    src: "../templates/vhosts/nginx.conf.j2"
    dest: "/etc/{{ fubarhouse_webserver }}/conf.d/{{ item.name }}.conf"
    owner: root
    group: root
    mode: 0777
  with_items:
    - "{{ fubarhouse_vhosts }}"
  when: fubarhouse_vhosts.0 is defined

- name: "Virtual hosts | NGINX | Create virtual host (sites-available)"
  become: yes
  become_user: root
  template:
    src: "../templates/vhosts/nginx.conf.j2"
    dest: "/etc/{{ fubarhouse_webserver }}/sites-available/{{ item.name }}.conf"
    owner: root
    group: root
    mode: 0777
  with_items:
    - "{{ fubarhouse_vhosts }}"
  when: fubarhouse_vhosts.0 is defined

- name: "Virtual hosts | NGINX | Create virtual host (sites-enabled)"
  become: yes
  become_user: root
  template:
    src: "../templates/vhosts/nginx.conf.j2"
    dest: "/etc/{{ fubarhouse_webserver }}/sites-enabled/{{ item.name }}.conf"
    owner: root
    group: root
    mode: 0777
  with_items:
    - "{{ fubarhouse_vhosts }}"
  when: fubarhouse_vhosts.0 is defined